// https://github.com/johnwalley/d3-bumps-chart/ v1.1.0 Copyright 2019 John Walley
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-scale"),require("d3-shape"),require("d3-array"),require("d3-dispatch"),require("d3-transition"),require("d3-dsv")):"function"==typeof define&&define.amd?define(["exports","d3-scale","d3-shape","d3-array","d3-dispatch","d3-transition","d3-dsv"],e):e((t=t||self).d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,(function(t,e,r,n,s,a,o){"use strict";var i,l=function(t,e,r){for(var n=-1,s=Object(t),a=r(t),o=a.length;o--;){var l=a[i?o:++n];if(!1===e(s[l],l,s))break}return t};var u="object"==typeof global&&global&&global.Object===Object&&global,c="object"==typeof self&&self&&self.Object===Object&&self,f=u||c||Function("return this")(),d=f.Symbol,h=Object.prototype,p=h.hasOwnProperty,v=h.toString,y=d?d.toStringTag:void 0;var g=Object.prototype.toString;var b="[object Null]",m="[object Undefined]",w=d?d.toStringTag:void 0;function S(t){return null==t?void 0===t?m:b:w&&w in Object(t)?function(t){var e=p.call(t,y),r=t[y];try{t[y]=void 0;var n=!0}catch(t){}var s=v.call(t);return n&&(e?t[y]=r:delete t[y]),s}(t):function(t){return g.call(t)}(t)}function _(t){return null!=t&&"object"==typeof t}var C="[object Arguments]";function j(t){return _(t)&&S(t)==C}var O=Object.prototype,x=O.hasOwnProperty,A=O.propertyIsEnumerable,k=j(function(){return arguments}())?j:function(t){return _(t)&&x.call(t,"callee")&&!A.call(t,"callee")},E=Array.isArray;var D="object"==typeof t&&t&&!t.nodeType&&t,M=D&&"object"==typeof module&&module&&!module.nodeType&&module,I=M&&M.exports===D?f.Buffer:void 0,T=(I?I.isBuffer:void 0)||function(){return!1},$=9007199254740991,P=/^(?:0|[1-9]\d*)$/;function H(t,e){var r=typeof t;return!!(e=null==e?$:e)&&("number"==r||"symbol"!=r&&P.test(t))&&t>-1&&t%1==0&&t<e}var N=9007199254740991;function z(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=N}var R={};R["[object Float32Array]"]=R["[object Float64Array]"]=R["[object Int8Array]"]=R["[object Int16Array]"]=R["[object Int32Array]"]=R["[object Uint8Array]"]=R["[object Uint8ClampedArray]"]=R["[object Uint16Array]"]=R["[object Uint32Array]"]=!0,R["[object Arguments]"]=R["[object Array]"]=R["[object ArrayBuffer]"]=R["[object Boolean]"]=R["[object DataView]"]=R["[object Date]"]=R["[object Error]"]=R["[object Function]"]=R["[object Map]"]=R["[object Number]"]=R["[object Object]"]=R["[object RegExp]"]=R["[object Set]"]=R["[object String]"]=R["[object WeakMap]"]=!1;var F,L="object"==typeof t&&t&&!t.nodeType&&t,B=L&&"object"==typeof module&&module&&!module.nodeType&&module,G=B&&B.exports===L&&u.process,W=function(){try{var t=B&&B.require&&B.require("util").types;return t||G&&G.binding&&G.binding("util")}catch(t){}}(),V=W&&W.isTypedArray,X=V?(F=V,function(t){return F(t)}):function(t){return _(t)&&z(t.length)&&!!R[S(t)]},Y=Object.prototype.hasOwnProperty;function U(t,e){var r=E(t),n=!r&&k(t),s=!r&&!n&&T(t),a=!r&&!n&&!s&&X(t),o=r||n||s||a,i=o?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],l=i.length;for(var u in t)!e&&!Y.call(t,u)||o&&("length"==u||s&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||H(u,l))||i.push(u);return i}var Q=Object.prototype;var J=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),q=Object.prototype.hasOwnProperty;function K(t){if(r=(e=t)&&e.constructor,e!==("function"==typeof r&&r.prototype||Q))return J(t);var e,r,n=[];for(var s in Object(t))q.call(t,s)&&"constructor"!=s&&n.push(s);return n}function Z(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var tt="[object AsyncFunction]",et="[object Function]",rt="[object GeneratorFunction]",nt="[object Proxy]";function st(t){if(!Z(t))return!1;var e=S(t);return e==et||e==rt||e==tt||e==nt}function at(t){return null!=(e=t)&&z(e.length)&&!st(e)?U(t):K(t);var e}function ot(t,e){return t&&l(t,e,at)}function it(t,e){return t===e||t!=t&&e!=e}function lt(t,e){for(var r=t.length;r--;)if(it(t[r][0],e))return r;return-1}var ut=Array.prototype.splice;function ct(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ct.prototype.clear=function(){this.__data__=[],this.size=0},ct.prototype.delete=function(t){var e=this.__data__,r=lt(e,t);return!(r<0)&&(r==e.length-1?e.pop():ut.call(e,r,1),--this.size,!0)},ct.prototype.get=function(t){var e=this.__data__,r=lt(e,t);return r<0?void 0:e[r][1]},ct.prototype.has=function(t){return lt(this.__data__,t)>-1},ct.prototype.set=function(t,e){var r=this.__data__,n=lt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var ft,dt=f["__core-js_shared__"],ht=(ft=/[^.]+$/.exec(dt&&dt.keys&&dt.keys.IE_PROTO||""))?"Symbol(src)_1."+ft:"";var pt=Function.prototype.toString;function vt(t){if(null!=t){try{return pt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var yt=/^\[object .+?Constructor\]$/,gt=Function.prototype,bt=Object.prototype,mt=gt.toString,wt=bt.hasOwnProperty,St=RegExp("^"+mt.call(wt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function _t(t){return!(!Z(t)||function(t){return!!ht&&ht in t}(t))&&(st(t)?St:yt).test(vt(t))}function Ct(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return _t(r)?r:void 0}var jt=Ct(f,"Map"),Ot=Ct(Object,"create");var xt="__lodash_hash_undefined__",At=Object.prototype.hasOwnProperty;var kt=Object.prototype.hasOwnProperty;var Et="__lodash_hash_undefined__";function Dt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Mt(t,e){var r,n,s=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?s["string"==typeof e?"string":"hash"]:s.map}function It(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Dt.prototype.clear=function(){this.__data__=Ot?Ot(null):{},this.size=0},Dt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Dt.prototype.get=function(t){var e=this.__data__;if(Ot){var r=e[t];return r===xt?void 0:r}return At.call(e,t)?e[t]:void 0},Dt.prototype.has=function(t){var e=this.__data__;return Ot?void 0!==e[t]:kt.call(e,t)},Dt.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Ot&&void 0===e?Et:e,this},It.prototype.clear=function(){this.size=0,this.__data__={hash:new Dt,map:new(jt||ct),string:new Dt}},It.prototype.delete=function(t){var e=Mt(this,t).delete(t);return this.size-=e?1:0,e},It.prototype.get=function(t){return Mt(this,t).get(t)},It.prototype.has=function(t){return Mt(this,t).has(t)},It.prototype.set=function(t,e){var r=Mt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var Tt=200;function $t(t){var e=this.__data__=new ct(t);this.size=e.size}$t.prototype.clear=function(){this.__data__=new ct,this.size=0},$t.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},$t.prototype.get=function(t){return this.__data__.get(t)},$t.prototype.has=function(t){return this.__data__.has(t)},$t.prototype.set=function(t,e){var r=this.__data__;if(r instanceof ct){var n=r.__data__;if(!jt||n.length<Tt-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new It(n)}return r.set(t,e),this.size=r.size,this};var Pt="__lodash_hash_undefined__";function Ht(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new It;++e<r;)this.add(t[e])}function Nt(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function zt(t,e){return t.has(e)}Ht.prototype.add=Ht.prototype.push=function(t){return this.__data__.set(t,Pt),this},Ht.prototype.has=function(t){return this.__data__.has(t)};var Rt=1,Ft=2;function Lt(t,e,r,n,s,a){var o=r&Rt,i=t.length,l=e.length;if(i!=l&&!(o&&l>i))return!1;var u=a.get(t);if(u&&a.get(e))return u==e;var c=-1,f=!0,d=r&Ft?new Ht:void 0;for(a.set(t,e),a.set(e,t);++c<i;){var h=t[c],p=e[c];if(n)var v=o?n(p,h,c,e,t,a):n(h,p,c,t,e,a);if(void 0!==v){if(v)continue;f=!1;break}if(d){if(!Nt(e,(function(t,e){if(!zt(d,e)&&(h===t||s(h,t,r,n,a)))return d.push(e)}))){f=!1;break}}else if(h!==p&&!s(h,p,r,n,a)){f=!1;break}}return a.delete(t),a.delete(e),f}var Bt=f.Uint8Array;function Gt(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function Wt(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var Vt=1,Xt=2,Yt="[object Boolean]",Ut="[object Date]",Qt="[object Error]",Jt="[object Map]",qt="[object Number]",Kt="[object RegExp]",Zt="[object Set]",te="[object String]",ee="[object Symbol]",re="[object ArrayBuffer]",ne="[object DataView]",se=d?d.prototype:void 0,ae=se?se.valueOf:void 0;var oe=Object.prototype.propertyIsEnumerable,ie=Object.getOwnPropertySymbols,le=ie?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,s=0,a=[];++r<n;){var o=t[r];e(o,r,t)&&(a[s++]=o)}return a}(ie(t),(function(e){return oe.call(t,e)})))}:function(){return[]};function ue(t){return function(t,e,r){var n=e(t);return E(t)?n:function(t,e){for(var r=-1,n=e.length,s=t.length;++r<n;)t[s+r]=e[r];return t}(n,r(t))}(t,at,le)}var ce=1,fe=Object.prototype.hasOwnProperty;var de=Ct(f,"DataView"),he=Ct(f,"Promise"),pe=Ct(f,"Set"),ve=Ct(f,"WeakMap"),ye=vt(de),ge=vt(jt),be=vt(he),me=vt(pe),we=vt(ve),Se=S;(de&&"[object DataView]"!=Se(new de(new ArrayBuffer(1)))||jt&&"[object Map]"!=Se(new jt)||he&&"[object Promise]"!=Se(he.resolve())||pe&&"[object Set]"!=Se(new pe)||ve&&"[object WeakMap]"!=Se(new ve))&&(Se=function(t){var e=S(t),r="[object Object]"==e?t.constructor:void 0,n=r?vt(r):"";if(n)switch(n){case ye:return"[object DataView]";case ge:return"[object Map]";case be:return"[object Promise]";case me:return"[object Set]";case we:return"[object WeakMap]"}return e});var _e=Se,Ce=1,je="[object Arguments]",Oe="[object Array]",xe="[object Object]",Ae=Object.prototype.hasOwnProperty;function ke(t,e,r,n,s,a){var o=E(t),i=E(e),l=o?Oe:_e(t),u=i?Oe:_e(e),c=(l=l==je?xe:l)==xe,f=(u=u==je?xe:u)==xe,d=l==u;if(d&&T(t)){if(!T(e))return!1;o=!0,c=!1}if(d&&!c)return a||(a=new $t),o||X(t)?Lt(t,e,r,n,s,a):function(t,e,r,n,s,a,o){switch(r){case ne:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case re:return!(t.byteLength!=e.byteLength||!a(new Bt(t),new Bt(e)));case Yt:case Ut:case qt:return it(+t,+e);case Qt:return t.name==e.name&&t.message==e.message;case Kt:case te:return t==e+"";case Jt:var i=Gt;case Zt:var l=n&Vt;if(i||(i=Wt),t.size!=e.size&&!l)return!1;var u=o.get(t);if(u)return u==e;n|=Xt,o.set(t,e);var c=Lt(i(t),i(e),n,s,a,o);return o.delete(t),c;case ee:if(ae)return ae.call(t)==ae.call(e)}return!1}(t,e,l,r,n,s,a);if(!(r&Ce)){var h=c&&Ae.call(t,"__wrapped__"),p=f&&Ae.call(e,"__wrapped__");if(h||p){var v=h?t.value():t,y=p?e.value():e;return a||(a=new $t),s(v,y,r,n,a)}}return!!d&&(a||(a=new $t),function(t,e,r,n,s,a){var o=r&ce,i=ue(t),l=i.length;if(l!=ue(e).length&&!o)return!1;for(var u=l;u--;){var c=i[u];if(!(o?c in e:fe.call(e,c)))return!1}var f=a.get(t);if(f&&a.get(e))return f==e;var d=!0;a.set(t,e),a.set(e,t);for(var h=o;++u<l;){var p=t[c=i[u]],v=e[c];if(n)var y=o?n(v,p,c,e,t,a):n(p,v,c,t,e,a);if(!(void 0===y?p===v||s(p,v,r,n,a):y)){d=!1;break}h||(h="constructor"==c)}if(d&&!h){var g=t.constructor,b=e.constructor;g!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b)&&(d=!1)}return a.delete(t),a.delete(e),d}(t,e,r,n,s,a))}function Ee(t,e,r,n,s){return t===e||(null==t||null==e||!_(t)&&!_(e)?t!=t&&e!=e:ke(t,e,r,n,Ee,s))}var De=1,Me=2;function Ie(t){return t==t&&!Z(t)}function Te(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}}function $e(t){var e=function(t){for(var e=at(t),r=e.length;r--;){var n=e[r],s=t[n];e[r]=[n,s,Ie(s)]}return e}(t);return 1==e.length&&e[0][2]?Te(e[0][0],e[0][1]):function(r){return r===t||function(t,e,r,n){var s=r.length,a=s,o=!n;if(null==t)return!a;for(t=Object(t);s--;){var i=r[s];if(o&&i[2]?i[1]!==t[i[0]]:!(i[0]in t))return!1}for(;++s<a;){var l=(i=r[s])[0],u=t[l],c=i[1];if(o&&i[2]){if(void 0===u&&!(l in t))return!1}else{var f=new $t;if(n)var d=n(u,c,l,t,e,f);if(!(void 0===d?Ee(c,u,De|Me,n,f):d))return!1}}return!0}(r,t,e)}}var Pe="[object Symbol]";function He(t){return"symbol"==typeof t||_(t)&&S(t)==Pe}var Ne=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ze=/^\w*$/;function Re(t,e){if(E(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!He(t))||(ze.test(t)||!Ne.test(t)||null!=e&&t in Object(e))}var Fe="Expected a function";function Le(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Fe);var r=function(){var n=arguments,s=e?e.apply(this,n):n[0],a=r.cache;if(a.has(s))return a.get(s);var o=t.apply(this,n);return r.cache=a.set(s,o)||a,o};return r.cache=new(Le.Cache||It),r}Le.Cache=It;var Be=500;var Ge=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,We=/\\(\\)?/g,Ve=function(t){var e=Le(t,(function(t){return r.size===Be&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Ge,(function(t,r,n,s){e.push(n?s.replace(We,"$1"):r||t)})),e}));var Xe=1/0,Ye=d?d.prototype:void 0,Ue=Ye?Ye.toString:void 0;function Qe(t){if("string"==typeof t)return t;if(E(t))return function(t,e){for(var r=-1,n=null==t?0:t.length,s=Array(n);++r<n;)s[r]=e(t[r],r,t);return s}(t,Qe)+"";if(He(t))return Ue?Ue.call(t):"";var e=t+"";return"0"==e&&1/t==-Xe?"-0":e}function Je(t){return null==t?"":Qe(t)}function qe(t,e){return E(t)?t:Re(t,e)?[t]:Ve(Je(t))}var Ke=1/0;function Ze(t){if("string"==typeof t||He(t))return t;var e=t+"";return"0"==e&&1/t==-Ke?"-0":e}function tr(t,e){for(var r=0,n=(e=qe(e,t)).length;null!=t&&r<n;)t=t[Ze(e[r++])];return r&&r==n?t:void 0}function er(t,e){return null!=t&&e in Object(t)}function rr(t,e){return null!=t&&function(t,e,r){for(var n=-1,s=(e=qe(e,t)).length,a=!1;++n<s;){var o=Ze(e[n]);if(!(a=null!=t&&r(t,o)))break;t=t[o]}return a||++n!=s?a:!!(s=null==t?0:t.length)&&z(s)&&H(o,s)&&(E(t)||k(t))}(t,e,er)}var nr=1,sr=2;function ar(t,e){return Re(t)&&Ie(e)?Te(Ze(t),e):function(r){var n=function(t,e,r){var n=null==t?void 0:tr(t,e);return void 0===n?r:n}(r,t);return void 0===n&&n===e?rr(r,t):Ee(e,n,nr|sr)}}function or(t){return t}function ir(t){return function(e){return null==e?void 0:e[t]}}function lr(t){return Re(t)?ir(Ze(t)):function(t){return function(e){return tr(e,t)}}(t)}function ur(t){return"function"==typeof t?t:null==t?or:"object"==typeof t?E(t)?ar(t[0],t[1]):$e(t):lr(t)}function cr(t,e){return function(t,e,r){var n;return r(t,(function(t,r,s){if(e(t,r,s))return n=r,!1})),n}(t,ur(e),ot)}function fr(t){return t!=t}function dr(t,e){return!!(null==t?0:t.length)&&function(t,e,r){return e==e?function(t,e,r){for(var n=r-1,s=t.length;++n<s;)if(t[n]===e)return n;return-1}(t,e,r):function(t,e,r,n){for(var s=t.length,a=r+(n?1:-1);n?a--:++a<s;)if(e(t[a],a,t))return a;return-1}(t,fr,r)}(t,e,0)>-1}function hr(t,e,r){for(var n=-1,s=null==t?0:t.length;++n<s;)if(r(e,t[n]))return!0;return!1}var pr=pe&&1/Wt(new pe([,-0]))[1]==1/0?function(t){return new pe(t)}:function(){},vr=200;function yr(t,e,r){var n=-1,s=dr,a=t.length,o=!0,i=[],l=i;if(r)o=!1,s=hr;else if(a>=vr){var u=e?null:pr(t);if(u)return Wt(u);o=!1,s=zt,l=new Ht}else l=e?[]:i;t:for(;++n<a;){var c=t[n],f=e?e(c):c;if(c=r||0!==c?c:0,o&&f==f){for(var d=l.length;d--;)if(l[d]===f)continue t;e&&l.push(f),i.push(c)}else s(l,f,r)||(l!==i&&l.push(f),i.push(c))}return i}function gr(t,e){return t&&t.length?yr(t,ur(e)):[]}var br=9007199254740991,mr=Math.floor;function wr(t,e){var r="";if(!t||e<1||e>br)return r;do{e%2&&(r+=t),(e=mr(e/2))&&(t+=t)}while(e);return r}function Sr(t,e,r){var n=t.length;return r=void 0===r?n:r,!e&&r>=n?t:function(t,e,r){var n=-1,s=t.length;e<0&&(e=-e>s?0:s+e),(r=r>s?s:r)<0&&(r+=s),s=e>r?0:r-e>>>0,e>>>=0;for(var a=Array(s);++n<s;)a[n]=t[n+e];return a}(t,e,r)}var _r=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function Cr(t){return _r.test(t)}var jr=ir("length"),Or="[\\ud800-\\udfff]",xr="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ar="\\ud83c[\\udffb-\\udfff]",kr="[^\\ud800-\\udfff]",Er="(?:\\ud83c[\\udde6-\\uddff]){2}",Dr="[\\ud800-\\udbff][\\udc00-\\udfff]",Mr="(?:"+xr+"|"+Ar+")"+"?",Ir="[\\ufe0e\\ufe0f]?"+Mr+("(?:\\u200d(?:"+[kr,Er,Dr].join("|")+")[\\ufe0e\\ufe0f]?"+Mr+")*"),Tr="(?:"+[kr+xr+"?",xr,Er,Dr,Or].join("|")+")",$r=RegExp(Ar+"(?="+Ar+")|"+Tr+Ir,"g");function Pr(t){return Cr(t)?function(t){for(var e=$r.lastIndex=0;$r.test(t);)++e;return e}(t):jr(t)}var Hr="[\\ud800-\\udfff]",Nr="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",zr="\\ud83c[\\udffb-\\udfff]",Rr="[^\\ud800-\\udfff]",Fr="(?:\\ud83c[\\udde6-\\uddff]){2}",Lr="[\\ud800-\\udbff][\\udc00-\\udfff]",Br="(?:"+Nr+"|"+zr+")"+"?",Gr="[\\ufe0e\\ufe0f]?"+Br+("(?:\\u200d(?:"+[Rr,Fr,Lr].join("|")+")[\\ufe0e\\ufe0f]?"+Br+")*"),Wr="(?:"+[Rr+Nr+"?",Nr,Fr,Lr,Hr].join("|")+")",Vr=RegExp(zr+"(?="+zr+")|"+Wr+Gr,"g");function Xr(t){return Cr(t)?function(t){return t.match(Vr)||[]}(t):function(t){return t.split("")}(t)}var Yr=Math.ceil;function Ur(t,e){var r=(e=void 0===e?" ":Qe(e)).length;if(r<2)return r?wr(e,t):e;var n=wr(e,Yr(t/Pr(e)));return Cr(e)?Sr(Xr(n),0,t).join(""):n.slice(0,t)}var Qr=NaN,Jr=/^\s+|\s+$/g,qr=/^[-+]0x[0-9a-f]+$/i,Kr=/^0b[01]+$/i,Zr=/^0o[0-7]+$/i,tn=parseInt;var en=1/0,rn=17976931348623157e292;function nn(t){return t?(t=function(t){if("number"==typeof t)return t;if(He(t))return Qr;if(Z(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Z(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Jr,"");var r=Kr.test(t);return r||Zr.test(t)?tn(t.slice(2),r?2:8):qr.test(t)?Qr:+t}(t))===en||t===-en?(t<0?-1:1)*rn:t==t?t:0:0===t?t:0}function sn(t){var e=nn(t),r=e%1;return e==e?r?e-r:e:0}function an(t,e,r){t=Je(t);var n=(e=sn(e))?Pr(t):0;return e&&n<e?Ur(e-n,r)+t:t}const on={MEN:"Men",WOMEN:"Women"},ln={EIGHTS:"Summer Eights",TORPIDS:"Torpids",LENTS:"Lent Bumps",MAYS:"May Bumps",TOWN:"Town Bumps"},un={A:"Addenbrooke's",AR:"Anglia Ruskin",Ca:"Caius",CC:"Corpus Christi",CH:"Clare Hall",Cl:"Clare",Cr:"Christ's",CT:"CCAT",Cu:"Churchill",D:"Downing",Dw:"Darwin",E:"Emmanuel",F:"Fitzwilliam",G:"Girton",H:"Homerton",HH:"Hughes Hall",HHL:"Hughes/Lucy",J:"Jesus",K:"King's",L:"LMBC",LC:"Lucy Cavendish",M:"Magdalene",ME:"Murray Edwards",N:"Newnham",NH:"New Hall",Pb:"Pembroke",Ph:"Peterhouse",Q:"Queens'",QM:"QMABC",R:"Robinson",S:"Selwyn",SC:"St Catharine's",SE:"St Edmund's",SS:"Sidney Sussex",T:"1st and 3rd",TC:"Theological Colleges",TH:"Trinity Hall",VS:"Vet School",W:"Wolfson"},cn={B:"Balliol",Br:"Brasenose",Ch:"Christ Church",Co:"Corpus Christi",E:"Exeter",H:"Hertford",J:"Jesus",K:"Keble",L:"Linacre",Lc:"Lincoln",LM:"L.M.H.",Mg:"Magdalen",Mf:"Mansfield",Mt:"Merton",N:"New College",O:"Oriel",OG:"Osler-Green",P:"Pembroke",Q:"Queen's",R:"Regent's Park",SE:"S.E.H.",S:"Somerville",SAn:"St Anne's",SAt:"St Antony's",SB:"St Benet's Hall",SC:"St Catherine's",SHi:"St Hilda's",SHu:"St Hugh's",SJ:"St John's",SP:"St Peter's",T:"Trinity",U:"University",Wh:"Wadham",Wf:"Wolfson",Wt:"Worcester"},fn={A:"Addenbrooke's",CB:"Camb Blue",CV:"Camb Veterans",Ct:"Cantabs",Cy:"City",Ca:"Caius",CT:"CCAT",Cr:"Christ's",Cu:"Churchill",CH:"Clare Hall",Cl:"Clare",CC:"Corpus Christi",COT:"Champs",Dn:"Domino",Dw:"Darwin",D:"Downing",E:"Emmanuel",F:"Fitzwilliam",FP:"Free Press",G:"Girton",H:"Homerton",HH:"Hughes Hall",Hn:"Hornets",I:"Ionica",IOE:"Isle of Ely",J:"Jesus",K:"King's",L:"LMBC",LC:"Lucy Cavendish",LS:"Lady Somerset",M:"Magdalene",ME:"Maximum Entropy",MM:"Mott MacDonald",NH:"New Hall",N:"Newnham",NN:"99",Pb:"Pembroke",Ph:"Peterhouse",QM:"QMABC",Q:"Queens'",RR:"Rob Roy",R:"Robinson",Sm:"Simoco",SI:"St Ives",SN:"St Neots",SR:"St Radegund",S:"Selwyn",SS:"Sidney Sussex",SC:"St Catharine's",SE:"St Edmund's",T:"1st & 3rd",TC:"Theological Colleges",Te:"Telephones",TH:"Trinity Hall",US:"Univ Sports",VS:"Vet School",W:"Wolfson",X:"X-Press"},dn=["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX"];function hn(t,e){const r=t.replace(/[0-9]+$/,"").trim(),n=+t.substring(r.length);let s;switch(e){case ln.LENTS:case ln.MAYS:s=un;break;case ln.TORPIDS:case ln.EIGHTS:s=cn;break;case ln.TOWN:s=fn;break;default:throw"Unrecognised set: "+e}return void 0!==cr(s,t=>t===r)?cr(s,t=>t===r)+(n>1?n:""):t}function pn(t,e){const r=t.replace(/[0-9]+$/,"").trim();let n,s;switch(e){case ln.LENTS:case ln.MAYS:n=un,s="college";break;case ln.TORPIDS:case ln.EIGHTS:n=cn,s="college";break;case ln.TOWN:n=fn,s="town";break;default:return t}if(Object.prototype.hasOwnProperty.call(n,r)){const e=t.substring(r.length);return t=n[r],"college"===s&&e.length>0?t=t+" "+dn[+e-1]:"town"===s&&e.length>0&&+e>1&&(t=t+" "+ +e),t}if("college"===s){const e=t.substring(r.length);return e.length>0&&(t=r.trim()+(+e>1?" "+dn[+e-1]:"")),t}return"town"===s&&" 1"===t.substring(t.length-2)?t.substring(0,t.length-2):t}function vn(t){const e=t.split(/\s/);let r=t+" 1";return dn.forEach((t,n)=>{e[e.length-1]===t&&(r=e.slice(0,e.length-1).join(" ")+" "+(n+1))}),r}function yn(t){const e={A:"#0000ff",AR:"#ffff00",Ca:"#afe9c6",CC:"#800000",CH:"#ffff00",Cl:"#ffff00",Cr:"#000080",CT:"##ffff00",Cu:"#ff55dd",D:"#d400aa",Dw:"#000080",E:"#eeaaff",F:"#808080",G:"#005500",H:"#000000",HH:"#0096ff",HHL:"#0044aa",J:"#8b0000",K:"#5a2ca0",L:"#ff0000",LC:"#0044aa",M:"#672178",ME:"#000000",N:"#010040",NH:"#000000",Pb:"#afe9dd",Ph:"#003380",Q:"#008001",QM:"#808080",R:"#007fff",S:"#f9cc00",SC:"#9d0064",SE:"#0300fd",SS:"#000080",T:"#000080",TC:"#000000",TH:"#000000",VS:"#000000",W:"#5599ff"},r={Oriel:"#372e63"},n={City:"#f44336",Champs:"#f57400","Rob Roy":"#8b0000",Cantabs:"#00008b",99:"#5197ff",Chesterton:"#ffff00",Simoco:"#ffff00",Pye:"#ffff00","St Neots":"#b9dcff","X-Press":"#000000","Camb Blue":"#000000","Free Press":"#000000","St Radegund":"#ffff00","Camb Veterans":"#91b9a4","Isle of Ely":"#9ed5b8","Max Entropy":"#f44336","St Ives":"#e90000",Sharks:"#e90000"},s=t.replace(/[0-9]/,"");if(Object.prototype.hasOwnProperty.call(e,s))return e[s];const a=t.substring(0,t.length-2).trim();return Object.prototype.hasOwnProperty.call(n,a)?n[a]:Object.prototype.hasOwnProperty.call(r,a)?r[a]:"#f44336"}function gn(t){for(let e=0;e<t.length-1;e++)if(t[e+1]-t[e]>=0&&1!==t[e+1])return!1;return!0}function bn(t,e=Number.MAX_SAFE_INTEGER){for(let r=0;r<t.length-1;r++)if(t[r+1]-t[r]<=0&&t[r+1]!==e)return!1;return!0}function mn(t,e,r){for(let n=0;n<e;n++)if(t<r[n])return n}function wn(t,e,r){for(let n=0;n<e&&!(t<r[n]);n++)t-=r[n];return t}function Sn(t){return t.map(t=>t.length).reduce((t,e)=>(t.length>0&&(e+=t[t.length-1]),t.push(e),t),[])}function _n(t){let e="";const r=t.move,n=t.completed,s=t.divisions.length;for(let a=0;a<t.days;a++){let t=0;for(let o=s-1;o>=0;o--){n[a][o]=!0;const i=r[a][o].slice();o<s-1&&i.push(t);let l=i.length-1;for(;l>=0;){switch(i[l]){case 0:e+="r";break;case 1:0===l?e+="r":-1!==i[l-1]?e+="e1":(e+="u",l-=1);break;case 2:1===l?(e+="u",l-=1):e+=0===l?"r":"e2";break;case 3:-3!==i[l-3]?0===l?e+="r":1===l?(e+="u",l-=1):e+=2===l?"e2":"e3":e+="o3";break;case 4:1===l?(e+="u",l-=1):e+=3===l?"o3":"e4";break;case 5:1===l?(e+="u",l-=1):-5!==i[l-5]?e+="e5":e+="o5";break;case 6:1===l?(e+="u",l-=1):e+=3===l?"o3":5===l?"o5":"e6";break;case 7:-7!==i[l-7]?e+="e7":e+="o7";break;case 8:1===l?(e+="u",l-=1):e+=5===l?"o5":"e8";break;case 9:1===l?(e+="u",l-=1):-9!==i[l-9]?e+="e9":e+="o9";break;case-1:e+="e-1";break;case-2:e+="e-2";break;case-3:i[l+3]>3&&0===l||l+3===i.length||3!==i[l+3]&&(e+="e-3");break;case-4:e+="e-4";break;case-5:i[l+5]>5&&0===l||l+5===i.length||5!==i[l+5]&&(e+="e-5");break;case-6:e+="e-6";break;case-7:i[l+7]>7&&0===l||l+7===i.length||7!==i[l+7]&&(e+="e-7");break;case-8:e+="e-8";break;case-9:e+="e-9";break;case-10:e+="e-10";break;case-11:e+="e-11";break;case-12:e+="e-12"}l-=1}for(t=0,l=0;l<i.length;){if(i[l]>l){t=i[l]-l;break}l+=1}o>0&&(e+=" ")}e+="\n"}return t.results=e,t}function Cn(t,e){0!==e.length&&t.push(e)}function jn(t,e,r,n){if(r-n<1)return console.error("Bumping up above the top of the division: div "+e+", crew "+r+", up "+n),!1;if(0!==t[e-1][r-1-n])return console.error("Bumping a crew that has already got a result"),!1;if(t[e-1][r-1-n]=-n,r>t[e-1].length){for(var s=0;s<t[e].length;s++)if(s-t[e][s]==0){t[e][s]+=n;break}}else t[e-1][r-1]=n;return!0}function On(t,e,r,n){const s=t.divisions.length,a=t.divisions,o=t.move,i=t.finish;for(let l=0;l<t.days;l++)for(let u=0;u<e.length;u++)if(0===l){const i=+e[u].Division-1,c=wn(+e[u]["Start position"]-1,s,n);a[i][c]=`${e[u].Club} ${e[u].Crew}`,o[l][i][c]=+e[u]["Start position"]-+r[t.days*u+l].Position}else{let c=+r[t.days*u+l-1].Position-1;const f=Sn(a);let d=mn(c,s,f),h=wn(c,s,n);o[l][d][h]=+r[t.days*u+l-1].Position-+r[t.days*u+l].Position,l===t.days-1&&(d=mn(c=+r[t.days*u+l].Position-1,s,f),h=wn(c,s,n),i[d][h]=`${e[u].Club} ${e[u].Crew}`)}return t}const xn=110;t.GENDER=on,t.SET=ln,t.abbrevCamCollege=un,t.abbrevCamTown=fn,t.abbrevOxCollege=cn,t.abbreviate=function(t){for(let e=0;e<t.divisions.length;e++)for(let r=0;r<t.divisions[e].length;r++)t.divisions[e][r]=hn(t.divisions[e][r],t.set);for(let e=0;e<t.finish.length;e++)for(let r=0;r<t.finish[e].length;r++)t.finish[e][r]=hn(t.finish[e][r],t.set);return t},t.abbreviateCrew=hn,t.bumpsChart=function(){let t,a,o,i,l,u,c,f,d,h,p,v,y,g,b,m=5,w=new Set,S=!1;const _=s.dispatch("selectYear","highlightCrew","toggleSelectedCrew");function C(e){e.each((function(r){a=r,S||(t=e.select("svg"),f=t.append("g").attr("class","results-container"),d=f.append("g").attr("class","results"),f.append("rect").attr("class","touch-target"),(o=new Hammer(t.node())).on("panmove",(function(t){d.attr("transform",`translate(${t.deltaX-g(b)},0)`)})),o.on("panend",(function(t){const e=g.invert(-t.deltaX+g(b));let r=n.scan(a.divisions,(t,r)=>Math.abs(t.startDay-e)-Math.abs(r.startDay-e));var s,o;r+m>a.divisions.length&&(r=a.divisions.length-m),i=a.divisions[r].year,s=a.divisions[r].year,o=a.divisions[r+m-1].year,l={start:s,end:o},j(),_.call("selectYear",C,s,o)})),h=d.append("g").attr("class","divisions"),p=d.append("g").attr("class","years"),y=d.append("g").attr("class","lines"),v=t.append("g").attr("class","labels"),function(t){const e="clip"+(1e5*Math.random()|0);t.append("clipPath").attr("id",e).append("rect").attr("width",80).attr("height",800);const r="url(#"+e+")";t.select(".results-container").attr("clip-path",r)}(t),function(t){const e=t.append("defs").append("filter").attr("filterUnits","userSpaceOnUse").attr("width",1e5).attr("id","dropShadow");e.append("feGaussianBlur").attr("stdDeviation",0).attr("in","SourceAlpha"),e.append("feOffset").attr("dx",0).attr("dy",2);const r=e.append("feMerge");r.append("feMergeNode"),r.append("feMergeNode").attr("in","SourceGraphic")}(t),S=!0),j()}))}function j(){const s=a;if(void 0===s||0===s.crews.length||null===l)return;let o=n.scan(a.divisions,(t,e)=>Math.abs(t.year-i)-Math.abs(e.year-i));o+m>a.divisions.length&&(o=a.divisions.length-m),l={start:a.divisions[o].year,end:a.divisions[o+m-1].year};const S=s.crews;S.forEach(t=>t.highlighted=w.has(t.name)),S.forEach(t=>t.hover=u===t.name);const _=S.length>0?n.max(S,t=>n.max(t.values.filter(t=>null!==t),t=>t.pos)):0,C=[],j=[];let A=0;S[0].valuesSplit.forEach(t=>{C.push(t.values[0].day),C.push(t.values[t.values.length-1].day),j.push(5*A/4*xn),j.push(5*A/4*xn+xn),A+=1}),g=e.scaleLinear().domain(C).range(j);const k=e.scaleLinear().domain([-1,_]).range([10,34*_-10]),E=310+5*xn/4*m,D=34*_,M=c;t.attr("height",D/E*M).attr("viewBox",`-165, 0, ${E}, ${D}`);const I=s.divisions.find(t=>t.year===l.start).startDay,T=s.divisions.find(t=>t.year===l.end).startDay+s.divisions.find(t=>t.year===l.end).numDays;b=I;const $=I;let P=T;const H=n.max(s.crews.map(t=>n.max(t.values.filter(t=>t.pos>-1||t.day<P-5))));P>H-1&&(P=H-1),f.select(".touch-target").attr("x",0).attr("y",0).attr("width",M).attr("height",D+16).attr("fill","transparent"),d.attr("transform",`translate(${-g(b)},0)`),function(t,e){t.select("clipPath").select("rect").datum(m).attr("width",t=>(5*t-1)/4*xn).attr("height",e+16)}(t,D),function(t,e,r,n){const s=e.selectAll(".division-year").data(t.divisions,t=>t.year);s.exit().remove();const a=s.enter().append("g").attr("class","division-year").attr("id",t=>t.year);a.selectAll("rect.division").data(t=>t.divisions.map(e=>({start:e.start,size:e.size,startDay:t.startDay,numDays:t.numDays}))).enter().append("rect").attr("class","division").attr("id",t=>t.start).style("stroke","black").style("fill",(t,e)=>e%2?"#C4C4C4":"#FFFFFF").attr("y",t=>n(t.start-.5)).attr("width",xn).attr("height",t=>n(t.start+t.size)-n(t.start)),a.merge(s).attr("transform",t=>`translate(${r(t.startDay)},0)`),s.selectAll("rect.division").data(t=>t.divisions.map(e=>({start:e.start,size:e.size,startDay:t.startDay,numDays:t.numDays}))).enter().append("rect").attr("class","division").attr("id",t=>t.start).style("stroke","black").style("fill",(t,e)=>e%2?"#C4C4C4":"#FFFFFF").attr("y",t=>n(t.start-.5)).attr("width",xn).attr("height",t=>n(t.start+t.size)-n(t.start));const o=s.selectAll("rect.division").data(t=>t.divisions.map(e=>({start:e.start,size:e.size,startDay:t.startDay,numDays:t.numDays})));o.exit().remove(),o.attr("y",t=>n(t.start-.5)).attr("width",xn).attr("height",t=>n(t.start+t.size)-n(t.start)),o.enter().append("rect").attr("class","division").attr("id",t=>t.start).style("stroke","black").style("fill",(t,e)=>e%2?"#C4C4C4":"#FFFFFF").attr("y",t=>n(t.start-.5)).attr("width",xn).attr("height",t=>n(t.start+t.size)-n(t.start))}(s,h,g,k),function(t,e,r,n){const s=e.selectAll(".year").data(t.divisions.map(t=>t.year),t=>t);s.enter().append("text").attr("class","year").attr("x",e=>{const n=t.divisions.find(t=>t.year===e);if(void 0!==n)return r(n.startDay+n.numDays/2)}).attr("y",n(0)).style("font-size","22px").attr("text-anchor","middle").text(t=>t),s.attr("x",e=>{const n=t.divisions.find(t=>t.year===e);if(void 0!==n)return r(n.startDay+n.numDays/2)}),s.exit().remove()}(s,p,g,k),function(t,e,n,s,a){const o=r.line().defined(t=>null!==t&&t.pos>-1).x(t=>n(t.day)).y(t=>s(t.pos)),i=e.selectAll(".line").data(t,t=>t.name);i.exit().remove();const l=i.enter().append("g").attr("class",t=>`line ${t.name.replace(/ /g,"-")}`).classed("highlighted",t=>t.highlighted).style("filter",t=>t.highlighted||t.hover?"url(#dropShadow)":"").style("fill","none").style("stroke",t=>t.highlighted||t.hover?yn(t.name):"#000000").style("stroke-width",t=>t.highlighted||t.hover?"3px":"2px").style("stroke-opacity",t=>a.size>0?t.highlighted||t.hover?"1":"0.5":"1");l.selectAll("path.active").data(t=>t.valuesSplit).enter().append("path").attr("class","active").style("cursor","pointer").classed("blades",t=>t.blades).classed("spoons",t=>t.spoons).style("stroke-dasharray",t=>t.blades?"10,5":t.spoons?"5,5":null).attr("d",t=>o(t.values)),l.selectAll("path.background").data(t=>[t],t=>t.name).enter().append("path").attr("class","background").attr("d",t=>o(t.values)).style("stroke-opacity","0.1"),l.merge(i).classed("highlighted",t=>t.highlighted).style("filter",t=>t.highlighted||t.hover?"url(#dropShadow)":"").style("fill","none").style("stroke",t=>t.highlighted||t.hover?yn(t.name):"#000000").style("stroke-width",t=>t.highlighted||t.hover?"3px":"2px").style("stroke-opacity",t=>a.size>0?t.highlighted||t.hover?"1":"0.5":"1");const u=i.selectAll("path.active").data(t=>t.valuesSplit);u.exit().remove(),u.classed("blades",t=>t.blades).classed("spoons",t=>t.spoons).style("stroke-dasharray",t=>t.blades?"10,5":t.spoons?"5,5":null).attr("d",t=>o(t.values)),u.enter().append("path").attr("class","active").style("cursor","pointer").classed("blades",t=>t.blades).classed("spoons",t=>t.spoons).style("stroke-dasharray",t=>t.blades?"10,5":t.spoons?"5,5":null).attr("d",t=>o(t.values));const c=i.selectAll("path.background").data(t=>[t],t=>t.name);c.exit().remove(),c.enter().append("path").attr("class","background").attr("d",t=>o(t.values)).style("stroke-opacity","0.1"),c.attr("d",t=>o(t.values))}(S,y,g,k,w),function(t,e,r,n,s,o,i){const l=t=>{let e=r;for(;(void 0===t.values.find(t=>t.day===e)||-1===t.values.find(t=>t.day===e).pos)&&e>r-4;)e-=1;return t.values.find(t=>t.day===e).pos},u=e.selectAll(".finish-label").data(t.filter(t=>l(t)>-1),t=>t.name);u.enter().append("text").on("click",t=>{o(t.name)}).on("mouseover",t=>{"ontouchstart"in window||navigator.maxTouchPoints||i(t.name)}).on("mouseout",()=>{i(null)}).attr("class",t=>"label finish-label "+t.name.replace(/ /g,"-")).classed("highlighted",t=>t.highlighted).style("font-weight",t=>t.highlighted?"bold":"normal").datum(t=>({name:t.name,set:t.set,gender:t.gender,pos:l(t)})).attr("x",10).attr("dy",".35em").text(t=>pn(t.name,a.set)).attr("transform",t=>`translate(${(5*m-1)/4*xn},${n(t.pos)})`).style("font-size","16px").style("cursor","pointer"),u.classed("highlighted",t=>t.highlighted||t.hover).style("font-weight",t=>t.highlighted||t.hover?"bold":"normal").transition().duration(s).attr("transform",t=>`translate(${(5*m-1)/4*xn},${n(l(t))})`),u.exit().remove()}(S,v,P,k,400,O,x),function(t,e,r,n,s,o,i){const l=t=>{let e=t.values.find(t=>t.day===r);return void 0===e&&(e=t.values.find(t=>t.day===r-1)),e.pos},u=e.selectAll(".start-label").data(t.filter(t=>l(t)>-1),t=>t.name);u.enter().append("text").on("click",t=>{o(t.name)}).on("mouseover",t=>{i(t.name)}).on("mouseout",()=>{i(null)}).attr("class",t=>"label start-label "+t.name.replace(/ /g,"-")).classed("highlighted",t=>t.highlighted).style("font-weight",t=>t.highlighted?"bold":"normal").datum(t=>({name:t.name,set:t.set,gender:t.gender,pos:l(t)})).attr("x",-10).attr("dy",".35em").attr("text-anchor","end").text(t=>pn(t.name,a.set)).attr("transform",t=>`translate(0,${n(t.pos)})`).style("font-size","16px").style("cursor","pointer"),u.classed("highlighted",t=>t.highlighted||t.hover).style("font-weight",t=>t.highlighted||t.hover?"bold":"normal").transition().duration(s).attr("transform",t=>`translate(0,${n(l(t))})`),u.exit().remove()}(S,v,$,k,400,O,x),function(t,e,r,s,a,o){const i=e.selectAll(".position-label-right").data(n.range(0,t.filter(t=>(t=>{let e=r;for(;(void 0===t.values.find(t=>t.day===e)||-1===t.values.find(t=>t.day===e).pos)&&e>r-4;)e-=1;return t.values.find(t=>t.day===e).pos})(t)>-1).length),t=>t);i.enter().append("text").attr("class","position-label-right").text((t,e)=>e+1).style("fill","#888888").attr("dy",".35em").attr("text-anchor","end").attr("transform",(t,e)=>`translate(${(5*s+5)/4*xn},${a(e+1)})`).transition().duration(o).style("font-size","16px").style("opacity",1),i.transition().duration(o).attr("transform",(t,e)=>`translate(${(5*s+5)/4*xn},${a(e+1)})`),i.exit().transition().duration(o).style("opacity",0).remove()}(S,v,P,m,k,400),function(t,e,r,n,s){const a=[];let o=t.find(t=>t.year===r);void 0===o&&(o=t.find(t=>t.year===r-1));o.divisions.forEach(t=>{for(let e=0;e<t.size;e++)a.push(e+1)});const i=e.selectAll(".position-label-left").data(a,(t,e)=>e);i.enter().append("text").attr("class","position-label-left").text(t=>t).style("fill","#888888").attr("dy",".35em").attr("text-anchor","start").attr("transform",(t,e)=>`translate(${-5.6*xn/4},${n(e+1)})`).transition().duration(s).style("font-size","16px").style("opacity",1),i.transition().duration(s).text(t=>t).attr("transform",(t,e)=>`translate(${-5.6*xn/4},${n(e+1)})`),i.exit().transition().duration(s).style("opacity",0).remove()}(s.divisions,v,l.start,k,400)}function O(t){w.has(t)?w.delete(t):w.add(t),j(),_.call("toggleSelectedCrew",C,t)}function x(t){u=t,j(),_.call("highlightCrew",C,t)}return C.year=function(t){return arguments.length?(i=t,C):i},C.numYearsToView=function(t){return arguments.length?(m=t,C):m},C.highlightedCrew=function(t){return arguments.length?(u=t,C):u},C.selectedCrews=function(t){return arguments.length?(w=t,C):w},C.windowWidth=function(t){return arguments.length?(c=t,C):c},C.on=function(){const t=_.on.apply(_,arguments);return t===_?C:t},C},t.calculateNumYearsToview=function(t){return Math.max(0,Math.ceil((t-310)/xn))},t.calculateYearRange=function(t,e,r){let n,s;return null==t&&(t=e),t.end>e.end?n=(s=e.end)-r<e.start?e.start:s-r:t.end<e.start?e.start+r>e.end?(s=e.end,n=e.start):(s=e.start+r,n=e.start):(s=t.end)-r<e.start?(n=e.start)+r>t.end&&(s=Math.min(n+r,e.end)):n=s-r,{start:n,end:s}},t.crewColor=yn,t.expandCrew=function(t,e){const r=t.replace(/[0-9]+$/,"").trim(),n=+t.substring(r.length);let s;switch(e){case ln.LENTS:case ln.MAYS:s=un;break;case ln.TORPIDS:case ln.EIGHTS:s=cn;break;case ln.TOWN:s=fn;break;default:throw"Unrecognised set: "+e}return Object.prototype.hasOwnProperty.call(s,r)?s[r]+(n>1?n:""):t},t.isBlades=gn,t.isSpoons=bn,t.joinEvents=function(t,e,r){const s=[],a=[],o=[];let i=[],l=0;t.forEach(t=>{const e=n.max([...t.crews.map(t=>t.values.length),5]);i=i.concat(t.crews.map(t=>t.name)),s.push(t.year),o.push({year:t.year,divisions:t.divisions.map(t=>({start:t.start,size:t.size})),startDay:l,numDays:e-1}),l+=e});const u=n.min(s),c=n.max(s),f=(d=i)&&d.length?yr(d):[];var d;const h=n.max(t.map(t=>t.crews.length));return f.forEach(e=>{const r={name:e,values:[],valuesSplit:[]};l=0,t.forEach(t=>{const s=t.crews.filter(t=>t.name===e),a=n.max([...t.crews.map(t=>t.values.length),5])-1;if(s.length>0){const n=s[0].values.map(t=>({day:t.day+l,pos:t.pos}));for(let t=n.length;t<=a;t++)n.push({day:t+l,pos:-1});r.values=r.values.concat(n);const o=s[0].values.map(t=>t.pos),i=gn(o),u=bn(o,t.crews.length),c={name:e,day:l,blades:i,spoons:u,values:n};r.valuesSplit.push(c)}else{const t=[];for(let e=0;e<=a;e++)t.push({day:e+l,pos:-1});r.values=r.values.concat(t)}l+=a+1}),a.push(r)}),{set:e,gender:r,crews:a,startYear:u,endYear:c,maxCrews:h,divisions:o}},t.read_ad=function(t){let e={set:"Set",small:"Short",gender:"Gender",result:"",year:1970,days:1,divisions:[],results:[],move:[],finish:[],completed:[]};const r=(t=t.split("\n"))[0].split(/\s+/);switch(r[0]){case"EIGHTS":e.set=ln.EIGHTS,e.small="Eights";break;case"TORPIDS":e.set=ln.TORPIDS,e.small="Torpids"}e.year=+r[1];const n=t[1].trim().split(/\s+/);/NO RACING/i.test(t[1])?e.days=0:e.days=+n[0];const s=+n[1],a=parseInt(n[2],10);let o,i=[],l=[];for(let t=0;t<e.days+1;t++){i.push([]),l.push([]);for(let e=0;e<a;e++)l[t].push(e)}/women/i.test(t[2])?e.gender=on.WOMEN:/men/i.test(t[2])&&(e.gender=on.MEN);for(let r=2;r<s+a+2;r++)if(" "===t[r][0])o=[],e.divisions.push(o);else{const n=t[r].replace(/-?[0-9]+/g,"").trim(),s=t[r].replace(/([^\d- ]|-\D)/g,"").trim().split(/\s+/g);for(let t=0;t<e.days;t++)i[t].push(+s[t]);o.push(vn(n)),i.push()}for(let t=1;t<e.days+1;t++)for(let e=0;e<a;e++)l[t][e]=l[t-1][e]-i[t-1][e];for(let t=0;t<e.days;t++){let r=0;e.move.push([]),e.completed.push([]);for(let n=0;n<s;n++){e.move[t].push([]),e.completed[t].push(!0);for(let s=0;s<e.divisions[n].length;s++)e.move[t][n].push(i[t][l[t].indexOf(r)]),r++}}const u=[];for(let t=0;t<s;t++)for(let r=0;r<e.divisions[t].length;r++)u.push(e.divisions[t][r]);let c=0;for(let t=0;t<s;t++){e.finish.push([]);for(let r=0;r<e.divisions[t].length;r++)e.finish[t].push(u[l[e.days].indexOf(c)]),c++}return e="Torpids"===e.set?function(t){let e="";const r=t.move,n=t.completed,s=t.divisions.length;for(let a=0;a<t.days;a++){let o=0;for(let t=s-1;t>=0;t--){n[a][t]=!0;const i=r[a][t];o?(e+="e"+o,o=0):t<s-1&&(e+="r");let l=i.length-1;for(;l>=0;)0===i[l]?(e+="r",l-=1):i[l]>0&&0===l?(e+="r",l-=1):(e+="e"+i[l],l-=1);i[0]>0&&(o=i[0]),t>0&&(e+=" ")}a<t.days-1&&(e+="\n")}return t.results=e,t}(e):_n(e)},t.read_flat=function(t){const e=gr((t=o.csvParse(t)).map(t=>t.Year)),r=gr(t.map(t=>t.Sex)),n=[];for(let s=0;s<e.length;s++)for(let a=0;a<r.length;a++){let o={set:"Set",small:"Short",gender:"Gender",result:"",year:1970,days:4,divisions:[],results:[],move:[],finish:[],completed:[]};o.set="Town Bumps",o.gender=r[a],o.year=+e[s];const i=t.filter(t=>+t.Year===o.year&&t.Sex===o.gender&&"1"===t.Day);i.sort((t,e)=>+t["Start position"]-+e["Start position"]);const l=t.filter(t=>+t.Year===o.year&&t.Sex===o.gender);l.sort((t,e)=>{const r=+t["Start position"]-+e["Start position"];return 0===r?+t.Day-+e.Day:r}),o.days=gr(l.map(t=>t.Day)).length;const u=gr(i.map(t=>t.Division)).length,c=new Array(u);for(let t=0;t<u;t++)c[t]=i.filter(e=>+e.Division===t+1).length;o.divisions=new Array(u),o.finish=new Array(u),o.move=new Array(o.days),o.completed=new Array(o.days);for(let t=0;t<o.days;t++){o.move[t]=new Array(u),o.completed[t]=new Array(u);for(let e=0;e<u;e++)o.divisions[e]=new Array(c[e]),o.finish[e]=new Array(c[e]),o.move[t][e]=new Array(c[e]),o.completed[t][e]=!1}o=_n(o=On(o,i,l,c)),n.push(o)}return n},t.read_tg=function(t){t=t.split("\n");const e={set:"Set",small:"Short",gender:"Gender",result:"",year:1970,days:4,divisions:[],results:[],move:[],finish:[],completed:[]};let r=[],n=0,s=0;for(let a=0;a<t.length;a++){const o=t[a].split(",");if("Set"===o[0])o.length>1&&(e.set=o[1]);else if("Short"===o[0])e.small=o[1];else if("Gender"===o[0])e.gender=o[1];else if("Year"===o[0]){const t=parseInt(o[1],10);isNaN(t)||(e.year=t)}else if("Days"===o[0])e.days=parseInt(o[1],10);else if("Division"===o[0]){s=1,r.length>0&&(e.divisions.push(r),r=[]);for(let t=1;t<o.length;t++)Cn(r,o[t])}else if("Results"===o[0]){n=1,r.length>0&&(e.divisions.push(r),r=[]);for(let t=1;t<o.length;t++)0!==o[t].indexOf("#")&&Array.prototype.push.apply(e.results,o[t].split(" "))}else for(let t=0;t<o.length;t++)1===n&&0!==o[t].indexOf("#")?Array.prototype.push.apply(e.results,o[t].split(" ")):1===s&&Cn(r,o[t])}const a=[];for(let t=0;t<e.days;t++)a.push([]);e.results.filter(t=>""!==t).map((t,r)=>a[Math.floor(r/e.divisions.length)].push(t.trim())),e.results=a.filter(t=>t.length>0).map(t=>t.join(" ")).join("\n"),r.length>0&&e.divisions.push(r);for(let t=0;t<e.days;t++){const t=new Array(e.divisions.length),r=[];for(let n=0;n<e.divisions.length;n++){const s=new Array(e.divisions[n].length);for(let t=0;t<e.divisions[n].length;t++)s[t]=0;t[n]=s,r.push(!1)}e.move.push(t),e.completed.push(r)}return function(t){let e=[];t.results.length>0&&(e=t.results.match(/r|t|u|o[0-9]*|e-?[0-9]*/g));let r=0,n=0,s=0,a=null;for(let o=0;o<e.length;o++){for(;null!=a&&s<=a[n-1].length&&s>0&&0!==a[n-1][s-1];)s-=1;if(0===s){if("t"===e[o])continue;if(n<=1){if(r===t.days)return void console.error("Run out of days of racing with more results still to go");a=t.move[r],r+=1,n=t.divisions.length+1}s=a[--n-1].length,n<t.divisions.length&&s++}if(t.completed[r-1][n-1]=!0,"r"===e[o])s--;else if("u"===e[o]){if(!jn(a,n,s,1))return;s-=2}else if(0===e[o].indexOf("o")){if(!jn(a,n,s,parseInt(e[o].substring(1),10)))return;s--}else if(0===e[o].indexOf("e")){const t=parseInt(e[o].substring(1),10);s>a[n-1].length?a[n][0]+=t:a[n-1][s-1]=t,s--}else"t"===e[o]&&(s=0)}for(let e=0;e<t.divisions.length;e++)t.finish.push(new Array(t.divisions[e].length));for(let e=0;e<t.divisions.length;e++)for(let r=0;r<t.divisions[e].length;r++){let n=e,s=r;for(let e=0;e<t.days;e++){for(s-=t.move[e][n][s];s<0;)n--,s+=t.move[e][n].length;for(;s>=t.move[e][n].length;)s-=t.move[e][n].length,n++}t.finish[n][s]=t.divisions[e][r]}}(e),e},t.renderName=pn,t.transformData=function(t){if(t.days!==t.completed.length)throw new RangeError(`Expected ${t.days} but found ${t.completed.length} completed days`);let e=1;const r=[],n=[];for(let s=0;s<t.divisions.length;s++){n.push({start:e,size:t.divisions[s].length});for(let n=0;n<t.divisions[s].length;n++){const a=[];let o=0,i=e;a.push({day:o,pos:i});let l=n,u=s;for(let e=0;e<t.days&&!1!==t.completed[e][u];e++){const r=t.move[e][u][l];for(o+=1,i-=r,a.push({day:o,pos:i}),l-=r;l<0;)u--,l+=t.divisions[u].length;for(;l>=t.divisions[u].length;)l-=t.divisions[u].length,u++}r.push({name:t.finish[u][l],values:a}),e+=1}}return{year:t.year,crews:r,divisions:n}},t.write_ad=function(t){let e;switch(t.set){case ln.EIGHTS:e="EIGHTS";break;case ln.TORPIDS:e="TORPIDS"}const r=t.divisions.reduce((t,e)=>t+=e.length,0);let n=`${e} ${t.year}\n ${t.days}  ${t.divisions.length}  ${r}   = NDay, NDiv, NCrew\n`;return t.divisions.forEach((e,s)=>{let a;switch(t.gender){case on.MEN:a="Men's";break;case on.WOMEN:a="Women's"}let o=[];for(let e=0;e<t.days+1;e++){o.push([]);for(let t=0;t<r;t++)o[e].push(t)}let i=` ${e.length}  ${a} Div ${dn[s]}\n`;e.forEach((e,r)=>{let n=r,a=s;i+=`${function(t,e,r){t=Je(t);var n=(e=sn(e))?Pr(t):0;return e&&n<e?t+Ur(e-n,r):t}(pn(e,t.set),25)}`;for(let e=0;e<t.days;e++)i+=an(t.move[e][a][n],4),(n-=t.move[e][a][n])<0&&(a-=1,n+=t.divisions[a].length),n>=t.divisions[a].length&&(n-=t.divisions[a].length,a+=1);i+="\n"}),n+=i}),n},t.write_flat=function(t){let e="Year,Club,Sex,Day,Crew,Start position,Position,Division\n";for(let r=0;r<t.length;r++){const n=t[r],s=n.divisions.slice();s.unshift([]);const a=Sn(s);for(let t=0;t<n.divisions.length;t++){const r=n.divisions[t];for(let s=0;s<r.length;s++){const o=r[s].split(" "),i=o.pop(),l=o.join(" ");let u,c,f=s,d=t;for(let r=0;r<n.days;r++)0===r&&(c=a[t]+f+1),(f-=n.move[r][d][f])<0&&t>0?(f+=n.divisions[d-1].length,d-=1):f>=n.divisions[d].length&&t<n.divisions.length&&(f-=n.divisions[d].length,d+=1),u=a[d]+f+1,e+=`${n.year},${l},${n.gender},${r+1},${i},${c},${u},${t+1}\n`}}}return e},t.write_tg=function(t){let e=`Set,${t.set}\nShort,${t.small}\nGender,${t.gender}\nYear,${t.year}\n`;4!==t.days&&(e+=`Days,${t.days}\n`),e+="\n";for(let r=0;r<t.divisions.length;r++){e+="Division";for(let n=0;n<t.divisions[r].length;n++){e+=`,${t.divisions[r][n]}`}e+="\n"}return e+=`\nResults\n${t.results}`},Object.defineProperty(t,"__esModule",{value:!0})}));
